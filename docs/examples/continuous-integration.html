<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src\site\apt/examples\continuous-integration.apt.vm at 2022-07-20
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Olaf Otto" />
    <meta name="Date-Creation-yyyymmdd" content="20181214" />
    <meta name="Date-Revision-yyyymmdd" content="20220720" />
    <meta http-equiv="Content-Language" content="en" />
    <title>AEM Maven plugin &#x2013; Continuous integration with the aem-maven-plugin</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><div id="bannerLeft"><h2>AEM Maven plugin</h2>
</div>
</div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2022-07-20<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 2.0.17-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Overview</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../plugin-info.html" title="Goals"><span class="none"></span>Goals</a></li>
    <li><a href="http://www.apache.org/licenses/" class="externalLink" title="License"><span class="none"></span>License</a></li>
      <li class="nav-header">Examples</li>
    <li><a href="../examples/starting-and-stopping-local-aem-instance.html" title="Start, stop and kill an AEM instance"><span class="none"></span>Start, stop and kill an AEM instance</a></li>
    <li><a href="../examples/deploying-build-artifacts.html" title="Deploy files and artifacts to AEM"><span class="none"></span>Deploy files and artifacts to AEM</a></li>
    <li class="active"><a href="#"><span class="none"></span>Configure Continuous Integration</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<section>
<h2><a name="Continuous_integration_with_the_aem-maven-plugin"></a>Continuous integration with the aem-maven-plugin</h2>
<p>For continuous integration on a CI server, the usual lifecycle is:</p>
<p>Prepare quickstart artifact and license -&gt; install and start AEM instance -&gt; deploy project artifacts -&gt; restart -&gt; await initialization -&gt; execute tests -&gt; kill instance</p>
<p>This process can easily be modeled using the aem-maven plugin. The following example</p>
<ol style="list-style-type: decimal">
<li>provides a basic quickstart artifact (or pre-cooked AEM version) via the maven-dependency-plugin</li>
<li>starts or installs AEM via aem:start (this includes waiting for complete initialization)</li>
<li>deploys artifacts</li>
<li>restarts</li>
<li>executes integration tests</li>
<li>kills the instance</li></ol>
<p>Note that this sample config explicitly increases the timeout values for startup and installation - this can be necessary if deployments and configurations cause aem (re-)starts to take long. In addition, the <a class="externalLink" href="https://unic.github.io/aem-maven-plugin/deploy-mojo.html#pauseJcrInstaller">pauseJcrInstaller</a> flag will pause the installer before deployment and activate it afterwards. This means that bundles and configurations are not installed or applied while the deployment is running, thus stabilizing the deployment.</p>
<div class="source"><pre class="prettyprint"> &lt;plugin&gt;
     &lt;artifactId&gt;maven-dependency-plugin&lt;/artifactId&gt;
     &lt;version&gt;3.2.0&lt;/version&gt;
     &lt;executions&gt;
         &lt;execution&gt;
             &lt;id&gt;prepare-aem-quickstart&lt;/id&gt;
             &lt;phase&gt;generate-test-resources&lt;/phase&gt;
             &lt;goals&gt;
                 &lt;goal&gt;unpack&lt;/goal&gt;
             &lt;/goals&gt;
             &lt;configuration&gt;
                 &lt;artifactItems&gt;
                     &lt;artifactItem&gt;
                         &lt;!-- In this example, this zip contains a quickstart.jar and license.properties --&gt;
                         &lt;groupId&gt;com.example.company&lt;/groupId&gt;
                         &lt;artifactId&gt;aem-6.5&lt;/artifactId&gt;
                         &lt;version&gt;1.0.0&lt;/version&gt;
                         &lt;type&gt;zip&lt;/type&gt;
                         &lt;overWrite&gt;true&lt;/overWrite&gt;
                         &lt;outputDirectory&gt;${project.build.directory}/aem/publish&lt;/outputDirectory&gt;
                     &lt;/artifactItem&gt;
                 &lt;/artifactItems&gt;
             &lt;/configuration&gt;
         &lt;/execution&gt;
     &lt;/executions&gt;
 &lt;/plugin&gt;
 &lt;plugin&gt;
     &lt;groupId&gt;com.unic.maven.plugins&lt;/groupId&gt;
     &lt;artifactId&gt;aem-maven-plugin&lt;/artifactId&gt;
     &lt;version&gt;2.0.17-SNAPSHOT&lt;/version&gt;
     &lt;configuration&gt;
         &lt;aemType&gt;publish&lt;/aemType&gt;
         &lt;startupWaitTime&gt;5&lt;/startupWaitTime&gt;
         &lt;initializationWaitTime&gt;5&lt;/initializationWaitTime&gt;
         &lt;shutdownWaitTime&gt;5&lt;/shutdownWaitTime&gt;
         &lt;pauseJcrInstaller&gt;true&lt;/pauseJcrInstaller&gt;
     &lt;/configuration&gt;
     &lt;executions&gt;
         &lt;execution&gt;
             &lt;id&gt;prepare-aem-instance-for-test&lt;/id&gt;
             &lt;phase&gt;pre-integration-test&lt;/phase&gt;
             &lt;goals&gt;
                 &lt;goal&gt;kill&lt;/goal&gt; &lt;!-- Make sure no orphaned instance is running, e.g. due to a previously aborted build --&gt;
                 &lt;goal&gt;start&lt;/goal&gt; &lt;!-- Start or install the instance --&gt;
                 &lt;goal&gt;deploy&lt;/goal&gt; &lt;!-- Deploy the artifacts and / or files configured below --&gt;
                 &lt;goal&gt;restart&lt;/goal&gt; &lt;!-- Stop and Start --&gt;
             &lt;/goals&gt;
             &lt;configuration&gt;
                 &lt;deployArtifacts&gt;
                     &lt;artifact&gt;com.acme.groupId:acme-app-configurations:zip:${project.version}&lt;/artifact&gt;
                     &lt;artifact&gt;com.acme.groupId:acme-app-thirdparties:zip:${project.version}&lt;/artifact&gt;
                     &lt;artifact&gt;com.acme.groupId:acme-app:zip:${project.version}&lt;/artifact&gt;
                     &lt;artifact&gt;com.acme.groupId:acme-testcontent:zip:${project.version}&lt;/artifact&gt;
                 &lt;/deployArtifacts&gt;
             &lt;/configuration&gt;
         &lt;/execution&gt;
         &lt;execution&gt;
             &lt;id&gt;terminate&lt;/id&gt;
             &lt;phase&gt;post-integration-test&lt;/phase&gt;
             &lt;goals&gt;
                 &lt;goal&gt;kill&lt;/goal&gt;
             &lt;/goals&gt;
         &lt;/execution&gt;
     &lt;/executions&gt;
 &lt;/plugin&gt;
</pre></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2022.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
